---
layout: layouts/default.njk
datasets:
  - datacity/JobPostingsBySpecializedSkill
  - datacity/AveragePostingDurationBySpecializedSkill
---
{% macro jobs_table(jobs, area, total) %}
  <table class="centred">
    <thead>
      <tr>
        <th>SOC4 name</th>
        <th colspan=2>Job postings</th>
      </tf>
      <tr>
        <th>(sub-major level)</th>
        <th>count</th>
        <th>% of total</th>
      </tr>
    </thead>
    <tbody>
    {% for job in jobs %}
      <tr>
        <td>{{ job.sub_major_full_title }}</td>
        <td>{{ job[area] }}</td>
        <td>{{ job[area] | percentagize(total) }}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
{% endmacro %}

<h1>Skills demand based on job postings</h1>

<p>Datasets used:</p>

<ul>
  {% for dataset in datasets %}
    {% set page = search.page("url=/metadata/" + dataset + "/" ) %}
    <li>
      <a href="{{ page.url}}">
        {{ page.title }} from {{ page.origin }}
      </a>
    </li>
  {% endfor %}
</ul>

<h2>In-demand skills</h2>

<p>
  This chart shows the count of postings compared with the average duration of those postings.
  This is a proxy for difficult to fill jobs, either as demand is high, or the skill is niche.
</p>

<p>
  Hover over the points to show the geography of the point and the actual numbers.
</p>

<div data-dependencies="/assets/js/scatter-popup.js">
{{ comp.plot.scatter({
  config: {
    data: skills_demand_duration.rows,
    x: 'duration',
    y: 'count',
    margin: { left: 70 },
    radius: 4,
    nameMapper: mapper.demand.name.postingsDemandDuration,
    axis: {
      x: {
        title: 'Average duration of job posting'
      },
      y: {
        title: 'Count of job posting',
        padding: 50
      }
    }
  }
}) | safe }}
</div>

<h2>Postings (all Local Authorities)</h2>
<div class="chart" data-dependencies="/assets/oi/js/chart.js">
{{ comp.oi.viz.beta.tree_map({
  config: {
    table: postings.rows,
    grouping: mapper.treemap.soc4Demand.grouper,
    reduce: mapper.treemap.soc4Demand.reducer,
    width: 1200,
    height: 800,
    padding: 0,
    ratio: 2.5,
    dataMapper: mapper.treemap.soc4Demand.data,
    nameMapper: mapper.treemap.soc4Demand.name,
    valueKey: 'count'
  }
}) | safe }}
</div>

{%- set count = 15 -%}
{%- set jobs = postings_by_soc4_sub_major.rows | row_sort('Total') | head(count) -%}
<h3>Top {{ jobs | length }} job postings by SOC4 sub-major code (all Local Authorities)</h3>
{{ jobs_table(jobs, "Total", postings_summary['Total']) }}
  
{%- for area in areas -%}
  {%- set count = 5 -%}
  {%- set jobs = postings_by_soc4_sub_major.rows | row_sort(area) | head(count) -%}
  <h2>Top {{ jobs | length }} job postings by SOC4 sub-major code in {{ area }}</h2>
  {{ jobs_table(jobs, area, postings_summary[area]) }}
{%- endfor -%}
